<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Drag and Drop</title>
    <style>
      #preguntas-div,
      #respuestas-div {
        display: flex;
        justify-content: space-around;
        align-items: center;
        height: 200px;
      }

      .contenedor-arrastre {
        width: 150px;
        height: 100px;
        background-color: lightblue;
        text-align: center;
        line-height: 100px;
        cursor: pointer;
      }

      .area-soltar {
        width: 150px;
        height: 100px;
        border: 2px dashed gray;
        text-align: center;
        line-height: 100px;
      }
    </style>
  </head>
  <body>
    <div id="preguntas-div">
      <div class="contenedor-arrastre" draggable="true">
        Arrastra esta imagen1
      </div>
      <div class="contenedor-arrastre" draggable="true">
        Arrastra esta imagen2
      </div>
      <div class="contenedor-arrastre" draggable="true">
        Arrastra esta imagen3
      </div>
    </div>
    <div id="respuestas-div">
      <div class="area-soltar" draggable="true">Suelta la imagen aquí1</div>
      <div class="area-soltar" draggable="true">Suelta la imagen aquí2</div>
      <div class="area-soltar" draggable="true">Suelta la imagen aquí3</div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        let contenedor_preguntas = document.getElementById("contenedor1");
        let contenedor_respuestas = document.getElementById("contenedor2");
        async function cargardatos() {
          var xhr = new XMLHttpRequest();
          var url = "preguntas.php";
          xhr.open("POST", url, true);
          xhr.setRequestHeader("Content-Type", "application/json");

          xhr.onreadystatechange = function () {
            if (xhr.readyState == 4) {
              if (xhr.status == 200) {
                var datos = xhr.responseText;
                console.log(datos);
                var datosObj = JSON.parse(datos);
                if (datos !== "error") {
                  return datosObj;
                } else {
                  mensajeDiv.textContent = datos;
                  mensajeDiv.style.color = "red";
                }
              } else {
                console.error("Error:", xhr.statusText);
              }
            }
          };

          xhr.send();
        }

        async function general() {
          let datos = await cargardatos();
          generardatos(datos);
        }
        general();
        

        let primera_pregunta = null;
        let primera_respuesta = null;

        let preguntasdiv = document.getElementById("preguntas-div");
        let respuestasdiv = document.getElementById("respuestas-div");
        function generardatos(datos) {
          let parejas = 0;
          for (let dato of datos) {
            if (primera_pregunta == null) {
              var pregunta = document.createElement("div");
              pregunta.className = "contenedor-arrastre";
              pregunta.textContent = dato.titulo;
              pregunta.draggable = true;
              pregunta.id = parejas;
              overlayContent.appendChild(pregunta);
              var respuesta = document.createElement("div");
              respuesta.className = "area-soltar";
              respuesta.textContent = dato.titulo;
              respuesta.draggable = true;
              respuesta.id = parejas;
              preguntasdiv.appendChild(pregunta);
              respuestasdiv.appendChild(pregunta);
              primera_respuesta = respuesta;
              primera_pregunta = pregunta;
            } else {
              var pregunta = document.createElement("div");
              pregunta.className = "contenedor-arrastre";
              pregunta.textContent = dato.titulo;
              pregunta.draggable = true;
              pregunta.id = parejas;
              overlayContent.appendChild(pregunta);
              var respuesta = document.createElement("div");
              respuesta.className = "area-soltar";
              respuesta.textContent = dato.titulo;
              respuesta.draggable = true;
              respuesta.id = parejas;
              overlayContent.appendChild(pregunta);
              let orientacion_pregunta = Math.round(Math.random());
              if ((orientacion_pregunta = 0)) {
                preguntasdiv.insertBefore(
                  pregunta,
                  primera_pregunta.nextSibling
                );
              } else {
                preguntasdiv.insertBefore(pregunta, primera_pregunta);
              }
              let orientacion_respuesta = Math.round(Math.random());
              if ((orientacion_respuesta = 0)) {
                respuestasdiv.insertBefore(
                  respuesta,
                  primera_respuesta.nextSibling
                );
              } else {
                respuestasdiv.insertBefore(respuesta, primera_respuesta);
              }
            }
            parejas++;
          }
        }

        const contenedoresArrastre = document.querySelectorAll(
          ".contenedor-arrastre"
        );
        const areasSoltar = document.querySelectorAll(".area-soltar");
        let elementoArrastrado = null;

        contenedoresArrastre.forEach(function (contenedorArrastre) {
          contenedorArrastre.addEventListener("dragstart", function (event) {
            elementoArrastrado = event.target;
            event.dataTransfer.setData("text/plain", "Contenido arrastrado");
          });
        });

        areasSoltar.forEach(function (areaSoltar) {
          areaSoltar.addEventListener("dragover", function (event) {
            event.preventDefault();
          });

          areaSoltar.addEventListener("drop", function (event) {
            event.preventDefault();
            if (elementoArrastrado) {
              areaSoltar.innerHTML = "";
              //areaSoltar.appendChild(elementoArrastrado.cloneNode(true));
              areaSoltar.appendChild(elementoArrastrado);
              elementoArrastrado = null;
            }
          });
        });
      });
    </script>
  </body>
</html>
